{% extends 'base.html' %}
{% load static %}
{% load comment_filters %}

{% block title %}{{post.title}}{% endblock %}
{% block head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
  <style>
    .editor-toolbar a {
	    color: #ffffff!important;
    }
  </style>
{% endblock %}

{% block body %}
<main class="dark-mode" id="main">
  <p id="hidden" hidden>{{post.content}}</p>
  <section class="container pt-4 d-flex">
    <aside class="d-flex flex-column justify-content-start align-items-center p-2 m-4">
      <form action="{% url 'vote' post.id %}" method="POST" class="d-flex flex-column justify-content-start align-items-center">{% csrf_token %}
        <button type="submit" name="vote" value="up" style="border: none; background: none; color: inherit;" class="bi bi-chevron-up"></button>
        <p style="color: #1174f5; font-size: 14px;" class="m-0">{{post.likes}}</p>
        <button type="submit" name="vote" value="down" style="border: none; background: none; color: inherit;" class="bi bi-chevron-down"></button>
      </form>
      <p style="border-right: 1px dotted rgba(255, 255, 255, 0.2); height: 100%;"></p>
    </aside>  
      <div class="title-header">
        <div class="d-flex">
          <p><a class="creator" href="{% url 'profile' post.creator.id %}">{{ post.creator }}</a></p>
          <p class="date">{{post.creation_date}}</p>
        </div>
        <h3 class="t">{{ post.title }}</h3>
        <p class="article" id="show"></p>
      </div>
  </section>
  <hr>
  <section class="container text-white pt-4 border">
    <div class="form-group py-2">
      <button class="btn btn-dark btn-sm response" value="Publicar conteúdo">Responder</button>
    </div>

    <form class="form d-none" action="{% url 'comment_post' post.id %}" method="post">{% csrf_token %}
      <textarea name="text-content" id="mytextarea"></textarea>
      <div class="d-flex justify-content-end py-4 gap-3">
        <input class="btn btn-dark cancel" style="background-color: transparent;" value="Cancelar">
        <input type="submit" class="btn btn-success" value="Responder">
      </div>
    </form>
  </section>


  <section class="container text-white pt-4">
    {% for comment in comments %}
      <div style="background-color: black;" class="my-4">
        <p class="text-white">{{ comment.creator }} {{ comment.content }}</p>
        <section class="container text-white pt-4 border">
          <div class="form-group py-2">
            <button class="btn btn-dark btn-sm response" value="Publicar conteúdo">Responder</button>
          </div>

          <form class="form d-none" action="{% url 'comment_comment' comment.id %}" method="post">{% csrf_token %}
            
            <textarea name="text-content" id="mytextarea2"></textarea>
            <div class="d-flex justify-content-end py-4 gap-3">
              <input class="btn btn-dark cancel" style="background-color: transparent;" value="Cancelar">
              <input type="submit" class="btn btn-success" value="Responder">
            </div>
          </form>
        </section>

        {% include 'comment.html' with comments=comment.comments.all pai_comment=comment %}

      </div>
    {% endfor %}
  </section>



</main>
{% endblock %}

{% block script %}
<script type="text/javascript" src="https://unpkg.com/showdown/dist/showdown.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script>
  const htmlContent = document.createElement("div");
  var converter = new showdown.Converter(),
  text = document.getElementById('hidden').innerHTML;
  htmlContent.innerHTML = converter.makeHtml(text);
  document.getElementById('show').appendChild(htmlContent)


  const elements = document.getElementsByName('text-content')  
  for (let i = 0; i < elements.length; i++) {
  const element = elements[i];
  var simplemde = new SimpleMDE({
    element: element,
    spellChecker: false,
    previewRender: function(plainText) {
      return marked(plainText, {sanitize: true});
    },
    toolbar: [
      "bold", "italic", "heading", "|",
      "quote", "unordered-list", "ordered-list", "|",
      "link", "image", "|",
      {
        name: "preview",
        action: function(editor) {
          var previewWindow = window.open("", "_blank", "width=800, height=600, scrollbars=yes");
          var previewContent = marked(editor.value(), {sanitize: true});
          previewWindow.document.write(previewContent);
          previewWindow.document.close();
        },
        className: "fa fa-eye no-disable",
        title: "Preview"
      }
    ]
  })};
</script>
{% endblock %}