{% extends 'base.html' %}
{% load static %}

{% block title %}{{post.title}}{% endblock %}
{% block head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
{% endblock %}

{% block body %}
<main class="dark-mode" id="main">
  <p id="hidden" hidden>{{post.content}}</p>
  <section class="container pt-4 d-flex">
    <aside class="d-flex flex-column justify-content-start align-items-center p-2 m-4">
      <form action="{% url 'vote' post.id %}" method="POST" class="d-flex flex-column justify-content-start align-items-center">{% csrf_token %}
        <input type="hidden" name="type" value="post">
        <input type="hidden" name="id-post" value="{{post.id}}">
        <button type="submit" name="vote" value="up" style="border: none; background: none; color: inherit;" class="bi bi-chevron-up"></button>
        <p style="color: #1174f5; font-size: 14px;" class="m-0">{{post.likes}}</p>
        <button type="submit" name="vote" value="down" style="border: none; background: none; color: inherit;" class="bi bi-chevron-down"></button>
      </form>
      <p style="border-right: 1px dotted rgba(255, 255, 255, 0.2); min-height: 90%;" class="m-0"></p>
    </aside>
    <div class="title-header">
      <div class="d-flex">
        <p><a class="creator" href="{% url 'profile' post.creator.id %}">{{ post.creator }}</a></p>
        <p class="date">{{post.creation_date}}</p>
      </div>
      <h3 class="t">{{ post.title }}</h3>
      <p class="article" id="show"></p>
    </div>
  </section>
  <section class="container text-white pt-4">
    <div class="form-group py-2">
      <button class="btn btn-dark btn-sm response" value="Publicar conteÃºdo">Responder</button>
    </div>

    <form class="form d-none" action="{% url 'comment_post' post.id %}" method="post">{% csrf_token %}
      <textarea name="text-content" id="mytextarea"></textarea>
      <div class="d-flex justify-content-end py-4 gap-3"></div>
        <input type="button" class="btn btn-dark cancel" style="background-color: transparent;" value="Cancelar">
        <input type="submit" class="btn btn-success" value="Responder">
      </div>
    </form>
  </section>

  {% include 'partials/comment.html' with first_listing=True %}

</main>
{% endblock %}

{% block script %}
<script type="text/javascript" src="https://unpkg.com/showdown/dist/showdown.min.js"></script>
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script>
  const htmlContent = document.createElement("div");
  var converter = new showdown.Converter(),
  text = document.getElementById('hidden').innerHTML;
  htmlContent.innerHTML = converter.makeHtml(text);
  document.getElementById('show').appendChild(htmlContent)


  const elements = document.getElementsByName('text-content')  
  for (let i = 0; i < elements.length; i++) {
    var simplemde = new SimpleMDE({
      element: elements[i]
  })};
</script>
{% endblock %}